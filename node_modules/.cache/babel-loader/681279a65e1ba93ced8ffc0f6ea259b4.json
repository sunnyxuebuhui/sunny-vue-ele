{"remainingRequest":"/Users/chenyiquan/Vue/sunny-vue-ele/node_modules/babel-loader/lib/index.js!/Users/chenyiquan/Vue/sunny-vue-ele/src/config/fetch.js","dependencies":[{"path":"/Users/chenyiquan/Vue/sunny-vue-ele/src/config/fetch.js","mtime":1539662120019},{"path":"/Users/chenyiquan/Vue/sunny-vue-ele/node_modules/cache-loader/dist/cjs.js","mtime":1539661153075},{"path":"/Users/chenyiquan/Vue/sunny-vue-ele/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _typeof from \"/Users/chenyiquan/Vue/sunny-vue-ele/node_modules/@babel/runtime/helpers/builtin/es6/typeof\";\nimport \"core-js/modules/es6.object.define-property\";\nimport \"core-js/modules/es6.array.last-index-of\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.for-each\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/chenyiquan/Vue/sunny-vue-ele/node_modules/@babel/runtime/helpers/builtin/es6/asyncToGenerator\";\nimport { baseUrl } from './env';\nexport default\n/*#__PURE__*/\n_asyncToGenerator(\n/*#__PURE__*/\nregeneratorRuntime.mark(function _callee() {\n  var url,\n      data,\n      type,\n      method,\n      dataStr,\n      requestConfig,\n      response,\n      responseJson,\n      _args = arguments;\n  return regeneratorRuntime.wrap(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          url = _args.length > 0 && _args[0] !== undefined ? _args[0] : '';\n          data = _args.length > 1 && _args[1] !== undefined ? _args[1] : {};\n          type = _args.length > 2 && _args[2] !== undefined ? _args[2] : 'GET';\n          method = _args.length > 3 && _args[3] !== undefined ? _args[3] : 'fetch';\n          type = type.toUpperCase();\n          url = baseUrl + url;\n\n          if (type == 'GET') {\n            dataStr = ''; //数据拼接字符串\n\n            Object.keys(data).forEach(function (key) {\n              dataStr += key + '=' + data[key] + '&';\n            });\n\n            if (dataStr !== '') {\n              dataStr = dataStr.substr(0, dataStr.lastIndexOf('&'));\n              url = url + '?' + dataStr;\n            }\n          }\n\n          if (!(window.fetch && method == 'fetch')) {\n            _context.next = 25;\n            break;\n          }\n\n          requestConfig = {\n            credentials: 'include',\n            method: type,\n            headers: {\n              'Accept': 'application/json',\n              'Content-Type': 'application/json'\n            },\n            mode: \"cors\",\n            cache: \"force-cache\"\n          };\n\n          if (type == 'POST') {\n            Object.defineProperty(requestConfig, 'body', {\n              value: JSON.stringify(data)\n            });\n          }\n\n          _context.prev = 10;\n          _context.next = 13;\n          return fetch(url, requestConfig);\n\n        case 13:\n          response = _context.sent;\n          _context.next = 16;\n          return response.json();\n\n        case 16:\n          responseJson = _context.sent;\n          return _context.abrupt(\"return\", responseJson);\n\n        case 20:\n          _context.prev = 20;\n          _context.t0 = _context[\"catch\"](10);\n          throw new Error(_context.t0);\n\n        case 23:\n          _context.next = 26;\n          break;\n\n        case 25:\n          return _context.abrupt(\"return\", new Promise(function (resolve, reject) {\n            var requestObj;\n\n            if (window.XMLHttpRequest) {\n              requestObj = new XMLHttpRequest();\n            } else {\n              requestObj = new ActiveXObject();\n            }\n\n            var sendData = '';\n\n            if (type == 'POST') {\n              sendData = JSON.stringify(data);\n            }\n\n            requestObj.open(type, url, true);\n            requestObj.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n            requestObj.send(sendData);\n\n            requestObj.onreadystatechange = function () {\n              if (requestObj.readyState == 4) {\n                if (requestObj.status == 200) {\n                  var obj = requestObj.response;\n\n                  if (_typeof(obj) !== 'object') {\n                    obj = JSON.parse(obj);\n                  }\n\n                  resolve(obj);\n                } else {\n                  reject(requestObj);\n                }\n              }\n            };\n          }));\n\n        case 26:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _callee, this, [[10, 20]]);\n}));",{"version":3,"sources":["/Users/chenyiquan/Vue/sunny-vue-ele/src/config/fetch.js"],"names":["baseUrl","url","data","type","method","toUpperCase","dataStr","Object","keys","forEach","key","substr","lastIndexOf","window","fetch","requestConfig","credentials","headers","mode","cache","defineProperty","value","JSON","stringify","response","json","responseJson","Error","Promise","resolve","reject","requestObj","XMLHttpRequest","ActiveXObject","sendData","open","setRequestHeader","send","onreadystatechange","readyState","status","obj","parse"],"mappings":";;;;;;;;AAAA,SAASA,OAAT,QAAwB,OAAxB;AAEA;AAAA;AAAA;AAAA;AAAA,wBAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAMC,aAAN,2DAAY,EAAZ;AAAgBC,cAAhB,2DAAuB,EAAvB;AAA2BC,cAA3B,2DAAkC,KAAlC;AAAyCC,gBAAzC,2DAAkD,OAAlD;AACdD,iBAAOA,KAAKE,WAAL,EAAP;AACAJ,gBAAMD,UAAUC,GAAhB;;AAEA,cAAIE,QAAQ,KAAZ,EAAmB;AACdG,mBADc,GACJ,EADI,EACA;;AAClBC,mBAAOC,IAAP,CAAYN,IAAZ,EAAkBO,OAAlB,CAA0B,eAAO;AAChCH,yBAAWI,MAAM,GAAN,GAAYR,KAAKQ,GAAL,CAAZ,GAAwB,GAAnC;AACA,aAFD;;AAIA,gBAAIJ,YAAY,EAAhB,EAAoB;AACnBA,wBAAUA,QAAQK,MAAR,CAAe,CAAf,EAAkBL,QAAQM,WAAR,CAAoB,GAApB,CAAlB,CAAV;AACAX,oBAAMA,MAAM,GAAN,GAAYK,OAAlB;AACA;AACD;;AAda,gBAgBVO,OAAOC,KAAP,IAAgBV,UAAU,OAhBhB;AAAA;AAAA;AAAA;;AAiBTW,uBAjBS,GAiBO;AACnBC,yBAAa,SADM;AAEnBZ,oBAAQD,IAFW;AAGnBc,qBAAS;AACR,wBAAU,kBADF;AAER,8BAAgB;AAFR,aAHU;AAOnBC,kBAAM,MAPa;AAQnBC,mBAAO;AARY,WAjBP;;AA4Bb,cAAIhB,QAAQ,MAAZ,EAAoB;AACnBI,mBAAOa,cAAP,CAAsBL,aAAtB,EAAqC,MAArC,EAA6C;AAC5CM,qBAAOC,KAAKC,SAAL,CAAerB,IAAf;AADqC,aAA7C;AAGA;;AAhCY;AAAA;AAAA,iBAmCWY,MAAMb,GAAN,EAAWc,aAAX,CAnCX;;AAAA;AAmCNS,kBAnCM;AAAA;AAAA,iBAoCeA,SAASC,IAAT,EApCf;;AAAA;AAoCNC,sBApCM;AAAA,2CAqCLA,YArCK;;AAAA;AAAA;AAAA;AAAA,gBAuCN,IAAIC,KAAJ,aAvCM;;AAAA;AAAA;AAAA;;AAAA;AAAA,2CA0CN,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACvC,gBAAIC,UAAJ;;AACA,gBAAIlB,OAAOmB,cAAX,EAA2B;AAC1BD,2BAAa,IAAIC,cAAJ,EAAb;AACA,aAFD,MAEO;AACND,2BAAa,IAAIE,aAAJ,EAAb;AACA;;AAED,gBAAIC,WAAW,EAAf;;AACA,gBAAI/B,QAAQ,MAAZ,EAAoB;AACnB+B,yBAAWZ,KAAKC,SAAL,CAAerB,IAAf,CAAX;AACA;;AAED6B,uBAAWI,IAAX,CAAgBhC,IAAhB,EAAsBF,GAAtB,EAA2B,IAA3B;AACA8B,uBAAWK,gBAAX,CAA4B,cAA5B,EAA4C,mCAA5C;AACAL,uBAAWM,IAAX,CAAgBH,QAAhB;;AAEAH,uBAAWO,kBAAX,GAAgC,YAAM;AACrC,kBAAIP,WAAWQ,UAAX,IAAyB,CAA7B,EAAgC;AAC/B,oBAAIR,WAAWS,MAAX,IAAqB,GAAzB,EAA8B;AAC7B,sBAAIC,MAAMV,WAAWP,QAArB;;AACA,sBAAI,QAAOiB,GAAP,MAAe,QAAnB,EAA6B;AAC5BA,0BAAMnB,KAAKoB,KAAL,CAAWD,GAAX,CAAN;AACA;;AACDZ,0BAAQY,GAAR;AACA,iBAND,MAMO;AACNX,yBAAOC,UAAP;AACA;AACD;AACD,aAZD;AAaA,WA9BM,CA1CM;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAf","sourcesContent":["import { baseUrl } from './env'\n\nexport default async(url = '', data = {}, type = 'GET', method = 'fetch') => {\n\ttype = type.toUpperCase();\n\turl = baseUrl + url;\n\n\tif (type == 'GET') {\n\t\tlet dataStr = ''; //数据拼接字符串\n\t\tObject.keys(data).forEach(key => {\n\t\t\tdataStr += key + '=' + data[key] + '&';\n\t\t})\n\n\t\tif (dataStr !== '') {\n\t\t\tdataStr = dataStr.substr(0, dataStr.lastIndexOf('&'));\n\t\t\turl = url + '?' + dataStr;\n\t\t}\n\t}\n\n\tif (window.fetch && method == 'fetch') {\n\t\tlet requestConfig = {\n\t\t\tcredentials: 'include',\n\t\t\tmethod: type,\n\t\t\theaders: {\n\t\t\t\t'Accept': 'application/json',\n\t\t\t\t'Content-Type': 'application/json'\n\t\t\t},\n\t\t\tmode: \"cors\",\n\t\t\tcache: \"force-cache\"\n\t\t}\n\n\t\tif (type == 'POST') {\n\t\t\tObject.defineProperty(requestConfig, 'body', {\n\t\t\t\tvalue: JSON.stringify(data)\n\t\t\t})\n\t\t}\n\t\t\n\t\ttry {\n\t\t\tconst response = await fetch(url, requestConfig);\n\t\t\tconst responseJson = await response.json();\n\t\t\treturn responseJson\n\t\t} catch (error) {\n\t\t\tthrow new Error(error)\n\t\t}\n\t} else {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet requestObj;\n\t\t\tif (window.XMLHttpRequest) {\n\t\t\t\trequestObj = new XMLHttpRequest();\n\t\t\t} else {\n\t\t\t\trequestObj = new ActiveXObject;\n\t\t\t}\n\n\t\t\tlet sendData = '';\n\t\t\tif (type == 'POST') {\n\t\t\t\tsendData = JSON.stringify(data);\n\t\t\t}\n\n\t\t\trequestObj.open(type, url, true);\n\t\t\trequestObj.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n\t\t\trequestObj.send(sendData);\n\n\t\t\trequestObj.onreadystatechange = () => {\n\t\t\t\tif (requestObj.readyState == 4) {\n\t\t\t\t\tif (requestObj.status == 200) {\n\t\t\t\t\t\tlet obj = requestObj.response\n\t\t\t\t\t\tif (typeof obj !== 'object') {\n\t\t\t\t\t\t\tobj = JSON.parse(obj);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve(obj)\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(requestObj)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n}"]}]}