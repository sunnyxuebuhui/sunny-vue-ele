{"remainingRequest":"/Users/chenyiquan/Vue/sunny-vue-ele/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/chenyiquan/Vue/sunny-vue-ele/src/views/city/cityDetail.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/chenyiquan/Vue/sunny-vue-ele/src/views/city/cityDetail.vue","mtime":1539932323538},{"path":"/Users/chenyiquan/Vue/sunny-vue-ele/node_modules/cache-loader/dist/cjs.js","mtime":1539661153075},{"path":"/Users/chenyiquan/Vue/sunny-vue-ele/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/chenyiquan/Vue/sunny-vue-ele/node_modules/cache-loader/dist/cjs.js","mtime":1539661153075},{"path":"/Users/chenyiquan/Vue/sunny-vue-ele/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport HeadTop from '../../components/head.vue'\nimport {currentcity, searchplace} from '../../service/getData'\nimport {getStore, setStore, removeStore} from '../../config/mUtils'\n\nexport default {\n  components: {\n    HeadTop\n  },\n  data() {\n    return {\n      headTitle: '上海',\n      inputVaule: '', // 搜索地址\n      cityid: '1', // 当前城市id\n      cityname: '', // 当前城市名字\n      placelist: [], // 搜索城市列表\n      placeHistory: [], // 历史搜索记录\n      selectedPlaceList: [], // 选中的地址\n      isShowHis: true,\n      isShowList: false\n    }\n  },\n  mounted() {\n    this.initData()\n  },\n  methods: {\n    //发送搜索信息inputVaule\n    submit() {\n      // 输入值不为空时才发送信息\n      if (this.inputVaule) {\n        searchplace(this.cityid, this.inputVaule).then(res => {\n          this.placelist = res;\n          this.isShowHis = false\n          this.isShowList = true\n        })\n      }\n    },\n    initData(){\n      //获取搜索历史记录\n      if (getStore('placeHistory')) {\n        this.placeHistory = JSON.parse(getStore('placeHistory'))\n      } else {\n        this.placeHistory = []\n      }\n    },\n    onSelectPlace(item) {\n      this.setHisPlaceList(item)\n    },\n    setHisPlaceList(obj) {\n      let history = getStore('placeHistory')\n      let geohash = obj.geohash\n      if (history) {\n        let hisList = JSON.parse(history)\n        let falg = false\n        falg = hisList.some(item => item.geohash === geohash)\n        if (!falg) {\n          hisList.forEach(element => {\n            this.selectedPlaceList.unshift(element)\n          })\n          this.selectedPlaceList.unshift(obj)\n        } \n      } else {\n        this.selectedPlaceList.unshift(obj)\n      }\n      \n      setStore('placeHistory', this.selectedPlaceList)\n      this.selectedPlaceList = []\n      this.placeHistory = JSON.parse(getStore('placeHistory'))\n\n      this.$router.push({\n        name: 'home'\n      })\n    },\n    onSelectHis(item) {\n      this.$router.push({\n        name: 'home'\n      })\n    },\n    clearHistory() {\n      removeStore('placeHistory')\n      this.placeHistory.splice(0)\n    },\n    refresh() {\n      let scrolls = this.$refs.scrollList\n      setTimeout(() => {\n        scrolls.refresh()\n      }, 20)\n    }\n  },\n  watch: {\n    inputVaule(newVal) {\n      if (!newVal) {\n        this.isShowHis = true\n        this.isShowList = false\n      }\n    }\n  }\n}\n",{"version":3,"sources":["cityDetail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+BA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"cityDetail.vue","sourceRoot":"src/views/city","sourcesContent":["<template>\n  <div class=\"city_wrapper\">\n    <head-top :headTitle=\"headTitle\" :isShowSearch=\"false\">\n      <span class=\"change_city\" slot=\"changecity\">切换城市</span>\n    </head-top>\n    <div class=\"input_wrapper\">\n      <input type=\"text\" placeholder=\"输入学校、商务楼、地址\" v-model='inputVaule'>\n      <span class=\"btn\" @click=\"submit\">提交</span>\n    </div>\n    <div class=\"place_list\">\n      <scroll ref='scrollList' :data=\"placelist\">\n        <p class=\"his_title\" v-show=\"isShowHis && placeHistory.length > 0\">历史记录</p>\n        <ul class=\"his_place_list\" v-show=\"isShowHis\">\n          <li v-for=\"(item, index) in placeHistory\" :key=\"index\" @click=\"onSelectHis(item)\">\n            <p class=\"name\">{{item.name}}</p>\n            <p class=\"address\">{{item.address}}</p>\n          </li>\n        </ul>\n        <p class=\"clear\" v-if=\"isShowHis && placeHistory.length > 0\" @click=\"clearHistory\">清除所有</p>\n        <ul class=\"search_place_list\" v-show=\"isShowList\">\n          <li v-for=\"(item, index) in placelist\" :key=\"index\" @click=\"onSelectPlace(item)\">\n            <p class=\"name\">{{item.name}}</p>\n            <p class=\"address\">{{item.address}}</p>\n          </li>\n        </ul>\n      </scroll>\n    </div>\n  </div>\n</template>\n\n<script>\n  import HeadTop from '../../components/head.vue'\n  import {currentcity, searchplace} from '../../service/getData'\n  import {getStore, setStore, removeStore} from '../../config/mUtils'\n\n  export default {\n    components: {\n      HeadTop\n    },\n    data() {\n      return {\n        headTitle: '上海',\n        inputVaule: '', // 搜索地址\n        cityid: '1', // 当前城市id\n        cityname: '', // 当前城市名字\n        placelist: [], // 搜索城市列表\n        placeHistory: [], // 历史搜索记录\n        selectedPlaceList: [], // 选中的地址\n        isShowHis: true,\n        isShowList: false\n      }\n    },\n    mounted() {\n      this.initData()\n    },\n    methods: {\n      //发送搜索信息inputVaule\n      submit() {\n        // 输入值不为空时才发送信息\n        if (this.inputVaule) {\n          searchplace(this.cityid, this.inputVaule).then(res => {\n            this.placelist = res;\n            this.isShowHis = false\n            this.isShowList = true\n          })\n        }\n      },\n      initData(){\n        //获取搜索历史记录\n        if (getStore('placeHistory')) {\n          this.placeHistory = JSON.parse(getStore('placeHistory'))\n        } else {\n          this.placeHistory = []\n        }\n      },\n      onSelectPlace(item) {\n        this.setHisPlaceList(item)\n      },\n      setHisPlaceList(obj) {\n        let history = getStore('placeHistory')\n        let geohash = obj.geohash\n        if (history) {\n          let hisList = JSON.parse(history)\n          let falg = false\n          falg = hisList.some(item => item.geohash === geohash)\n          if (!falg) {\n            hisList.forEach(element => {\n              this.selectedPlaceList.unshift(element)\n            })\n            this.selectedPlaceList.unshift(obj)\n          } \n        } else {\n          this.selectedPlaceList.unshift(obj)\n        }\n        \n        setStore('placeHistory', this.selectedPlaceList)\n        this.selectedPlaceList = []\n        this.placeHistory = JSON.parse(getStore('placeHistory'))\n\n        this.$router.push({\n          name: 'home'\n        })\n      },\n      onSelectHis(item) {\n        this.$router.push({\n          name: 'home'\n        })\n      },\n      clearHistory() {\n        removeStore('placeHistory')\n        this.placeHistory.splice(0)\n      },\n      refresh() {\n        let scrolls = this.$refs.scrollList\n        setTimeout(() => {\n          scrolls.refresh()\n        }, 20)\n      }\n    },\n    watch: {\n      inputVaule(newVal) {\n        if (!newVal) {\n          this.isShowHis = true\n          this.isShowList = false\n        }\n      }\n    }\n  }\n</script>\n\n<style scoped lang=\"stylus\">\n  .city_wrapper\n    padding-top .44rem\n    width 100%\n    height 100%\n    .change_city\n      position absolute\n      right .1rem\n      top 50%\n      transform translateY(-50%)\n      font-size .14rem\n    .input_wrapper\n      position relative\n      margin-bottom .2rem\n      padding 0 .2rem\n      width 100%\n      height 1.4rem\n      box-sizing border-box\n      background-color #fff\n      input\n        position absolute\n        top 30%\n        left 50%\n        transform translate(-50%, -50%)\n        width 90%\n        height .4rem\n        background-color #f7f7f7\n        text-indent 1em\n        border none\n      .btn\n        position absolute\n        top 60%\n        left 50%\n        transform translate(-50%, 0%)\n        width 90%\n        height .4rem\n        line-height .4rem\n        text-align center\n        color #fff\n        font-size .18rem\n        border-radius .06rem\n        background-color #008de1\n    .place_list\n      position relative\n      padding 0 .1rem\n      width 100%\n      height calc(100% - 1.84rem)\n      overflow hidden\n      font-size .14rem\n      box-sizing border-box\n      background-color #fff\n      .his_title\n        padding .1rem 0 .1rem .1rem\n        font-size .16rem\n        color #333\n        font-weight 700\n        text-align left\n        border-bottom 1px solid #eee\n      .clear\n        padding .1rem 0 .1rem .1rem\n        font-size .16rem\n      .search_place_list, .his_place_list\n        li\n          display flex\n          flex-direction column\n          justify-content flex-start\n          text-align left \n          padding .1rem .1rem\n          width 100%\n          border-bottom 1px solid #eee\n          .name\n            color #333\n            font-size .16rem\n          .address\n            color #999\n            font-size .12rem\n</style>"]}]}